- device: launch_control
  controls:
    - midi_note:
      id: 1
      input: Launch Control
      channel: 2
      note: 9

    - midi_note:
      id: 2
      input: Launch Control
      channel: 2
      note: 10

    - midi_note:
      id: 3
      input: Launch Control
      channel: 2
      note: 11

    - midi_note_on:
      id: 7
      input: Launch Control
      channel: 2
      note: 27

    - midi_note:
      id: 8
      input: Launch Control
      channel: 2
      note: 28

    - midi_channel: launch_control_pads
      input: Launch Control
      output: Launch Control
      channel: 2

- page: main
  active: true
  widgets:
    - button: tempo_reset

    - button: shift_inc
      device: launch_control
      device_control_id: 1

    - button: tempo_dec
      device: launch_control
      device_control_id: 2

    - button: tempo_inc
      device: launch_control
      device_control_id: 3

    - button: clip_button
      device: launch_control
      device_control_id: 7

    - button: shift_tempo_shuffle
      device: launch_control
      device_control_id: 8

- page: shuffle
  active: false
  widgets:
    - button: shuffle_dec
      device: launch_control
      device_control_id: 2

    - button: shuffle_inc
      device: launch_control
      device_control_id: 3

    - button: shuffle_reset

- var: inc
  value: 1

- pipeline:
  pipe:
    - map: bool(shift_tempo_shuffle.value)
      vars:
        shift_tempo_shuffle.value: rx
    - out: shuffle.active

- pipeline:
  pipe:
    - map: shift_inc.value * 9 + 1
      vars:
        shift_inc.value: rx
    - out: inc.value

- pipeline:
  pipe:
    - filter: shuffle_dec.value > 0
      vars:
        shuffle_dec.value: rx
    - map: >
        clock.shuffle + inc.value * (
          input[0] * (-1)
        )
      vars:
        clock.shuffle: static
        inc.value: static
        input: rx
    - out: clock.shuffle

- pipeline:
  pipe:
    - filter: shuffle_inc.value > 0
      vars:
        shuffle_inc.value: rx
    - map: >
        clock.shuffle + inc.value * (
          input[0] * (+1)
        )
      vars:
        clock.shuffle: static
        inc.value: static
        input: rx
    - out: clock.shuffle

- pipeline:
  pipe:
    - filter: tempo_dec.value > 0
      vars:
        tempo_dec.value: rx
    - map: clock.tempo - inc.value * input[0]
      vars:
        input: rx
        clock.tempo: static
        inc.value: static
    - map: input * 1.0000
      vars:
        input: rx
    - out: clock.tempo

- pipeline:
  pipe:
    - filter: tempo_inc.value > 0
      vars:
        tempo_inc.value: rx
    - map: clock.tempo + inc.value * input[0]
      vars:
        input: rx
        clock.tempo: static
        inc.value: static
    - out: clock.tempo

- clock: clock
  tempo: 120
  shuffle: 50

- sequencer: seq1
  is_recording: False
  record_exists: False

- pipeline:
  pipe:
    - map: launch_control_pads.events_in
      vars:
        launch_control_pads.events_in: rx
    - out: seq1.events_in

- pipeline:
  pipe:
    - map: seq1.events_out
      vars:
        seq1.events_out: rx
    - out: launch_control_pads.events_out

- pipeline:
  pipe:
    - filter: seq1.record_exists == False
      vars:
        clip_button.value: rx
        seq1.record_exists: static
    - map: True
      vars:
        input: rx
    - out: seq1.recording_control

- pipeline:
  pipe:
    - filter: seq1.record_exists == True and seq1.is_recording
      vars:
        clip_button.value: rx
        seq1.record_exists: static
        seq1.is_recording: static
    - map: False
      vars:
        input: rx
    - out: seq1.recording_control

- pipeline:
  pipe:
    - filter: seq1.record_exists == True
      vars:
        clip_button.value: rx
        seq1.record_exists: static
    - map: True
      vars:
        input: rx
    - out: seq1.playback_control
